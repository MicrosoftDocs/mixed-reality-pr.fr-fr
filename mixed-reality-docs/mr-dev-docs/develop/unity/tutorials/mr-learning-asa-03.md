---
title: Enregistrement, récupération et partage d’ancres spatiales Azure
description: Suivez ce cours pour découvrir comment enregistrer, récupérer et partager des ancres spatiales Azure dans une application de réalité mixte.
author: jessemcculloch
ms.author: jemccull
ms.date: 07/01/2020
ms.topic: article
keywords: réalité mixte, unity, tutoriel, hololens, MRTK, mixed reality toolkit, UWP, ancres spatiales Azure, sessions d’application
ms.localizationpriority: high
ms.openlocfilehash: 4bae36bfb24130fc7914563af07c09374162f3cb
ms.sourcegitcommit: d3a3b4f13b3728cfdd4d43035c806c0791d3f2fe
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/20/2021
ms.locfileid: "98582056"
---
# <a name="3-saving-retrieving-and-sharing-azure-spatial-anchors"></a><span data-ttu-id="9f8f4-104">3. Enregistrement, récupération et partage d’ancres spatiales Azure</span><span class="sxs-lookup"><span data-stu-id="9f8f4-104">3. Saving, retrieving, and sharing Azure Spatial Anchors</span></span>

<span data-ttu-id="9f8f4-105">Dans ce tutoriel, vous allez apprendre à enregistrer des ancres spatiales Azure dans plusieurs sessions d’application en enregistrant l’ID d’ancre dans le stockage de HoloLens 2.</span><span class="sxs-lookup"><span data-stu-id="9f8f4-105">In this tutorial, you will learn how to save Azure Spatial Anchors across multiple app sessions by saving the anchor ID to the HoloLens 2's storage.</span></span> <span data-ttu-id="9f8f4-106">Vous allez également apprendre à partager cet ID d’ancre avec d’autres appareils à des fins d’alignement d’ancre sur plusieurs appareils.</span><span class="sxs-lookup"><span data-stu-id="9f8f4-106">You will also learn how to share this anchor ID to other devices for a multi-device anchor alignment.</span></span>

## <a name="objectives"></a><span data-ttu-id="9f8f4-107">Objectifs</span><span class="sxs-lookup"><span data-stu-id="9f8f4-107">Objectives</span></span>

* <span data-ttu-id="9f8f4-108">Apprendre à obtenir un alignement spatial entre plusieurs sessions d’application</span><span class="sxs-lookup"><span data-stu-id="9f8f4-108">Learn how to achieve spatial alignment across multiple app sessions.</span></span>
* <span data-ttu-id="9f8f4-109">Apprendre à obtenir un alignement spatial entre plusieurs appareils</span><span class="sxs-lookup"><span data-stu-id="9f8f4-109">Learn how to achieve spatial alignment between multiple devices.</span></span>

## <a name="preparing-the-scene"></a><span data-ttu-id="9f8f4-110">Préparation de la scène</span><span class="sxs-lookup"><span data-stu-id="9f8f4-110">Preparing the scene</span></span>

<span data-ttu-id="9f8f4-111">Dans la fenêtre de hiérarchie, développez l’objet **ButtonParent**.</span><span class="sxs-lookup"><span data-stu-id="9f8f4-111">In the Hierarchy window, expand the **ButtonParent** object.</span></span> <span data-ttu-id="9f8f4-112">Sélectionnez les **quatre derniers objets boutons enfants**.</span><span class="sxs-lookup"><span data-stu-id="9f8f4-112">Select the **last four child button** objects.</span></span> <span data-ttu-id="9f8f4-113">Dans la fenêtre de l’inspecteur, **cochez** la case en regard du champ de nom pour rendre tous les objets actifs.</span><span class="sxs-lookup"><span data-stu-id="9f8f4-113">In the Inspector window, **check** the checkbox next to the name field to make all the objects active.</span></span>

![Unity avec des objets de bouton précédemment inactifs sélectionnés et actifs](images/mr-learning-asa/asa-03-section1-step1-1.png)

<span data-ttu-id="9f8f4-115">Dans la fenêtre de hiérarchie, sélectionnez les objets **ButtonParent**.</span><span class="sxs-lookup"><span data-stu-id="9f8f4-115">In the Hierarchy window, select the **ButtonParent** objects.</span></span> <span data-ttu-id="9f8f4-116">Ensuite, dans la fenêtre de l’inspecteur, recherchez le composant **GridObjectCollection** et cliquez sur le bouton **Update Collection** pour mettre à jour la position de tous les objets enfants de l’objet **ButtonParent**.</span><span class="sxs-lookup"><span data-stu-id="9f8f4-116">Then in the Inspector window, locate the **GridObjectCollection** component and click the **Update Collection** button to update the position of all the **ButtonParent** object's child objects.</span></span>

![Unity avec le composant GridObjectCollection mis à jour](images/mr-learning-asa/asa-03-section1-step1-2.png)

## <a name="persisting-azure-spatial-anchors-between-app-sessions"></a><span data-ttu-id="9f8f4-118">Persistance des ancres spatiales Azure entre les sessions d’application</span><span class="sxs-lookup"><span data-stu-id="9f8f4-118">Persisting Azure Spatial Anchors between app sessions</span></span>

<span data-ttu-id="9f8f4-119">Dans cette section, vous allez découvrir comment enregistrer et récupérer l’ID d’ancre Azure sur le disque local HoloLens.</span><span class="sxs-lookup"><span data-stu-id="9f8f4-119">In this section, you will learn how to save and retrieve the Azure Anchor ID to and from the HoloLens' local disk.</span></span> <span data-ttu-id="9f8f4-120">Cela vous permettra d’interroger Azure pour obtenir le même ID d’ancre dans différentes sessions d’application.</span><span class="sxs-lookup"><span data-stu-id="9f8f4-120">This will allow you to query Azure for the same anchor ID between different app sessions.</span></span> <span data-ttu-id="9f8f4-121">Cela permettra également de positionner les hologrammes ancrés au même emplacement que dans la session d’application précédente.</span><span class="sxs-lookup"><span data-stu-id="9f8f4-121">It will enable the anchored holograms to be positioned at the same location as in the previous app session.</span></span>

<span data-ttu-id="9f8f4-122">Dans la fenêtre de hiérarchie, développez l’objet **ButtonParent** et recherchez les deux boutons nommés **SaveAzureAnchorIdToDisk** et **GetAzureAnchorIdFromDisk** :</span><span class="sxs-lookup"><span data-stu-id="9f8f4-122">In the Hierarchy window, expand the **ButtonParent** object and locate the two buttons named **SaveAzureAnchorIdToDisk** and **GetAzureAnchorIdFromDisk**:</span></span>

![Unity avec les objets de bouton SaveAzureAnchorIdToDisk et GetAzureAnchorIdFromDisk sélectionnés](images/mr-learning-asa/asa-03-section2-step1-1.png)

<span data-ttu-id="9f8f4-124">Suivez les mêmes étapes que celles indiquées dans [Configuration des boutons pour faire fonctionner la scène](mr-learning-asa-02.md#configuring-the-buttons-to-operate-the-scene) dans le tutoriel précédent afin de configurer le composant **Interactable (Script)** sur chacun des deux boutons :</span><span class="sxs-lookup"><span data-stu-id="9f8f4-124">Follow the same steps as in the [configuring the buttons to operate the scene](mr-learning-asa-02.md#configuring-the-buttons-to-operate-the-scene) instructions from the previous tutorial to configure the **Interactable (Script)** component on each of the two buttons:</span></span>

* <span data-ttu-id="9f8f4-125">Pour l’objet de bouton **SaveAzureAnchorIdToDisk**, affectez la fonction AnchorModuleScript > **SaveAzureAnchorIdToDisk ()** .</span><span class="sxs-lookup"><span data-stu-id="9f8f4-125">For the **SaveAzureAnchorIdToDisk** button object, assign the AnchorModuleScript > **SaveAzureAnchorIdToDisk ()** function.</span></span>
* <span data-ttu-id="9f8f4-126">Pour l’objet de bouton **GetAzureAnchorIdFromDisk**, affectez la fonction AnchorModuleScript > **GetAzureAnchorIdFromDisk ()** .</span><span class="sxs-lookup"><span data-stu-id="9f8f4-126">For the **GetAzureAnchorIdFromDisk** button object, assign the AnchorModuleScript > **GetAzureAnchorIdFromDisk ()** function.</span></span>

<span data-ttu-id="9f8f4-127">Si vous générez l’application mise à jour dans votre HoloLens, vous pouvez à présent conserver les ancres spatiales Azure entre les sessions d’application en enregistrant l’ID d’ancre Azure.</span><span class="sxs-lookup"><span data-stu-id="9f8f4-127">If you build the updated app to your HoloLens, you can now persist Azure Spatial Anchors between app sessions by saving the Azure Anchor ID.</span></span> <span data-ttu-id="9f8f4-128">Pour le tester, vous pouvez effectuer ces étapes :</span><span class="sxs-lookup"><span data-stu-id="9f8f4-128">To test it out, you can follow these steps:</span></span>

1. <span data-ttu-id="9f8f4-129">Déplacer le Rover Explorer à l’emplacement souhaité</span><span class="sxs-lookup"><span data-stu-id="9f8f4-129">Move the Rover Explorer to the desired location</span></span>
2. <span data-ttu-id="9f8f4-130">Démarrer la session Azure</span><span class="sxs-lookup"><span data-stu-id="9f8f4-130">Start Azure Session</span></span>
3. <span data-ttu-id="9f8f4-131">Créer une ancre Azure (cela crée des ancres à l’emplacement du Rover Explorer)</span><span class="sxs-lookup"><span data-stu-id="9f8f4-131">Create Azure Anchor (creates anchors at the location of the Rover Explorer)</span></span>
4. <span data-ttu-id="9f8f4-132">Enregistrer l’ID d’ancre Azure sur le disque</span><span class="sxs-lookup"><span data-stu-id="9f8f4-132">Save Azure Anchor ID to Disk</span></span>
5. <span data-ttu-id="9f8f4-133">Redémarrer l’application</span><span class="sxs-lookup"><span data-stu-id="9f8f4-133">Restart the app</span></span>
6. <span data-ttu-id="9f8f4-134">Obtenir l’ancre Azure à partir du disque (cela charge l’ID d’ancre que vous venez d’enregistrer)</span><span class="sxs-lookup"><span data-stu-id="9f8f4-134">Get Azure Anchor from Disk (loads the anchor ID you just saved)</span></span>
7. <span data-ttu-id="9f8f4-135">Démarrer la session Azure</span><span class="sxs-lookup"><span data-stu-id="9f8f4-135">Start Azure Session</span></span>
8. <span data-ttu-id="9f8f4-136">Rechercher l’ancre Azure (cela positionne le Rover Explorer à l’emplacement de l’étape 3)</span><span class="sxs-lookup"><span data-stu-id="9f8f4-136">Find Azure Anchor (positions the Rover Explorer at the location from step 3)</span></span>

> [!NOTE]
> <span data-ttu-id="9f8f4-137">Pour redémarrer complètement l’application après avoir quitté la vue d’application immersive, fermez la fenêtre de l’application dans l’accueil réalité mixte avant de la relancer à partir du menu Démarrer.</span><span class="sxs-lookup"><span data-stu-id="9f8f4-137">To fully restart the app, after exiting the immersive app view, the app window in the mixed reality home needs to be closed before relaunching it from the Start menu.</span></span> <span data-ttu-id="9f8f4-138">Pour plus d’informations, consultez la documentation [Utilisation d’applications sur HoloLens](/hololens/holographic-home#using-apps-on-hololens).</span><span class="sxs-lookup"><span data-stu-id="9f8f4-138">For additional details, you can refer to the [Using apps on HoloLens](/hololens/holographic-home#using-apps-on-hololens) documentation.</span></span>

## <a name="sharing-azure-spatial-anchors-between-devices"></a><span data-ttu-id="9f8f4-139">Partage d’ancres spatiales Azure entre des appareils</span><span class="sxs-lookup"><span data-stu-id="9f8f4-139">Sharing Azure Spatial Anchors between devices</span></span>

<span data-ttu-id="9f8f4-140">Dans cette section, vous allez apprendre à partager l’ID d’ancre Azure entre plusieurs appareils.</span><span class="sxs-lookup"><span data-stu-id="9f8f4-140">In this section, you will learn how to share the Azure Anchor ID between multiple devices.</span></span> <span data-ttu-id="9f8f4-141">Ainsi, plusieurs appareils peuvent demander à Azure le même ID d’ancre, ce qui permet d’aligner dans l’espace des hologrammes ancrés.</span><span class="sxs-lookup"><span data-stu-id="9f8f4-141">This will allow multiple devices to query Azure for the same anchor ID, allowing the anchored holograms to be spatially aligned.</span></span> <span data-ttu-id="9f8f4-142">L’alignement spatial, c’est-à-dire le fait de voir les mêmes hologrammes au même emplacement physique entre plusieurs appareils, est primordial pour les expériences partagées locales dans HoloLens 2.</span><span class="sxs-lookup"><span data-stu-id="9f8f4-142">Spatial alignment, i.e., seeing the same holograms in the same physical location between multiple devices, is key to local shared experiences in the HoloLens 2.</span></span>

<span data-ttu-id="9f8f4-143">Il existe de nombreuses façons de transférer des ID d’ancre Azure entre des appareils, notamment les méthodes décrites dans la série de [tutoriels sur les fonctionnalités multiutilisateurs](mr-learning-sharing-02.md).</span><span class="sxs-lookup"><span data-stu-id="9f8f4-143">There are many ways to transfer Azure Anchor IDs between devices, including methods outlined in the [Multi-user capabilities tutorials](mr-learning-sharing-02.md) series.</span></span> <span data-ttu-id="9f8f4-144">Dans cet exemple, vous allez utiliser un service web simple pour charger et télécharger des ID d’ancre entre des appareils.</span><span class="sxs-lookup"><span data-stu-id="9f8f4-144">In this example, you will use a simple web service to upload and download anchor IDs between devices.</span></span>

<span data-ttu-id="9f8f4-145">Dans la fenêtre de hiérarchie, développez l’objet **ButtonParent**.</span><span class="sxs-lookup"><span data-stu-id="9f8f4-145">In the Hierarchy window, expand the **ButtonParent** object.</span></span>   <span data-ttu-id="9f8f4-146">Recherchez les deux boutons nommés **ShareAzureAnchorIdToNetwork** et **GetAzureAnchorIdFromNetwork** :</span><span class="sxs-lookup"><span data-stu-id="9f8f4-146">Locate the two buttons named **ShareAzureAnchorIdToNetwork** and **GetAzureAnchorIdFromNetwork**:</span></span>

![Unity avec les objets de bouton ShareAzureAnchorIdToNetwork et GetAzureAnchorIdFromNetwork sélectionnés](images/mr-learning-asa/asa-03-section3-step1-1.png)

<span data-ttu-id="9f8f4-148">Suivez les mêmes étapes que celles indiquées dans [Configuration des boutons pour faire fonctionner la scène](mr-learning-asa-02.md#configuring-the-buttons-to-operate-the-scene) dans le tutoriel précédent afin de configurer le composant **Interactable (Script)** sur chacun des deux boutons :</span><span class="sxs-lookup"><span data-stu-id="9f8f4-148">Follow the same steps as in the [configuring the buttons to operate the scene](mr-learning-asa-02.md#configuring-the-buttons-to-operate-the-scene) instructions from the previous tutorial to configure the **Interactable (Script)** component on each of the two buttons:</span></span>

* <span data-ttu-id="9f8f4-149">Pour l’objet **ShareAzureAnchorIdToNetwork**, affectez la fonction AnchorModuleScript > **ShareAzureAnchorIdToNetwork ()** .</span><span class="sxs-lookup"><span data-stu-id="9f8f4-149">For the **ShareAzureAnchorIdToNetwork** object, assign the AnchorModuleScript > **ShareAzureAnchorIdToNetwork ()** function.</span></span>
* <span data-ttu-id="9f8f4-150">Pour l’objet **GetAzureAnchorIdFromNetwork**, affectez la fonction AnchorModuleScript > **GetAzureAnchorIdFromNetwork ()** .</span><span class="sxs-lookup"><span data-stu-id="9f8f4-150">For the **GetAzureAnchorIdFromNetwork** object, assign the AnchorModuleScript > **GetAzureAnchorIdFromNetwork ()** function.</span></span>

<span data-ttu-id="9f8f4-151">Si vous générez l’application mise à jour sur deux appareils HoloLens, vous pouvez à présent obtenir un alignement spatial en partageant l’ID d’ancre Azure.</span><span class="sxs-lookup"><span data-stu-id="9f8f4-151">If you build the updated app to two HoloLens devices, you can now achieve spatial alignment by sharing the Azure Anchor ID.</span></span> <span data-ttu-id="9f8f4-152">Pour le tester, vous pouvez effectuer ces étapes :</span><span class="sxs-lookup"><span data-stu-id="9f8f4-152">To test it out, you can follow these steps:</span></span>

1. <span data-ttu-id="9f8f4-153">Sur l’appareil HoloLens 1 : Déplacez le Rover Explorer à l’emplacement souhaité.</span><span class="sxs-lookup"><span data-stu-id="9f8f4-153">On HoloLens device 1: Move the Rover Explorer to the desired location.</span></span>
2. <span data-ttu-id="9f8f4-154">Sur l’appareil HoloLens 1 : Démarrez la session Azure.</span><span class="sxs-lookup"><span data-stu-id="9f8f4-154">On HoloLens device 1: Start Azure Session.</span></span>
3. <span data-ttu-id="9f8f4-155">Sur l’appareil HoloLens 1 : Créez une ancre Azure (cela crée des ancres à l’emplacement du Rover Explorer).</span><span class="sxs-lookup"><span data-stu-id="9f8f4-155">On HoloLens device 1: Create Azure Anchor (creates anchors at the location of the Rover Explorer).</span></span>
4. <span data-ttu-id="9f8f4-156">Sur l’appareil HoloLens 1 : Partagez l’ID d’ancre Azure sur le réseau.</span><span class="sxs-lookup"><span data-stu-id="9f8f4-156">On HoloLens device 1: Share Azure Anchor ID to Network.</span></span>
5. <span data-ttu-id="9f8f4-157">Sur l’appareil HoloLens 2 : Démarrez l’application.</span><span class="sxs-lookup"><span data-stu-id="9f8f4-157">On HoloLens device 2: Start the app.</span></span>
6. <span data-ttu-id="9f8f4-158">Sur l’appareil HoloLens 2 : Obtenez l’ID d’ancre partagé à partir du réseau (cela extrait l’ID d’ancre qui vient d’être partagé de l’appareil HoloLens 1).</span><span class="sxs-lookup"><span data-stu-id="9f8f4-158">On HoloLens device 2: Get Shared Anchor ID from Network (fetches the anchor ID just shared from HoloLens device 1).</span></span>
7. <span data-ttu-id="9f8f4-159">Sur l’appareil HoloLens 2 : Démarrez la session Azure.</span><span class="sxs-lookup"><span data-stu-id="9f8f4-159">On HoloLens device 2: Start Azure Session.</span></span>
8. <span data-ttu-id="9f8f4-160">Sur l’appareil HoloLens 2 : Recherchez l’ancre Azure (cela positionne le Rover Explorer à l’emplacement de l’étape 3).</span><span class="sxs-lookup"><span data-stu-id="9f8f4-160">On HoloLens device 2: Find Azure Anchor (positions the Rover Explorer at the location from step 3).</span></span>

> [!TIP]
> <span data-ttu-id="9f8f4-161">Si vous ne disposez que d’un appareil HoloLens, vous pouvez quand même tester la fonctionnalité en redémarrant l’application au lieu d’utiliser un second appareil HoloLens.</span><span class="sxs-lookup"><span data-stu-id="9f8f4-161">If you only have one HoloLens, you can still test the functionality by restarting the app instead of using a second HoloLens device.</span></span>

## <a name="congratulations"></a><span data-ttu-id="9f8f4-162">Félicitations</span><span class="sxs-lookup"><span data-stu-id="9f8f4-162">Congratulations</span></span>

<span data-ttu-id="9f8f4-163">Dans ce tutoriel, vous avez découvert comment conserver des ancres spatiales Azure entre les sessions d’application et les redémarrages d’application en enregistrant l’ID d’ancre spatiale Azure sur le disque local sur HoloLens.</span><span class="sxs-lookup"><span data-stu-id="9f8f4-163">In this tutorial, you learned how to persist Azure Spatial Anchors between app sessions and app restarts by saving the Azure Spatial Anchor ID to the local disk on HoloLens.</span></span> <span data-ttu-id="9f8f4-164">Vous avez également appris à partager des ancres spatiales Azure entre plusieurs appareils pour une expérience partagée d’hologramme statique multi-utilisateur de base.</span><span class="sxs-lookup"><span data-stu-id="9f8f4-164">You also learned how to share Azure Spatial Anchors between multiple devices for a basic multi-user, static hologram shared experience.</span></span>

<span data-ttu-id="9f8f4-165">Dans le tutoriel suivant, vous allez apprendre à offrir aux utilisateurs un retour en temps réel.</span><span class="sxs-lookup"><span data-stu-id="9f8f4-165">In the next tutorial, you will learn how to provide users with real-time feedback.</span></span> <span data-ttu-id="9f8f4-166">Ce retour inclut des informations sur la création d’ancres, la compréhension de qualité de l’environnement, et l’état de la session Azure.</span><span class="sxs-lookup"><span data-stu-id="9f8f4-166">This feedback will include information about Anchor creation, the quality of environment understanding, and the Azure session's state.</span></span> <span data-ttu-id="9f8f4-167">Sans retour, les utilisateurs risquent de ne pas savoir si une ancre a été correctement chargée sur Azure, si la qualité de l’environnement est suffisante pour créer une ancre ou pour l’état actuel.</span><span class="sxs-lookup"><span data-stu-id="9f8f4-167">Without feedback, users may not know whether an anchor has successfully been uploaded to Azure, whether the quality of the environment is sufficient for anchor creation, or the current state.</span></span>

> [!div class="nextstepaction"]
> [<span data-ttu-id="9f8f4-168">Tutoriel suivant : 4. Affichage des commentaires sur les ancres spatiales Azure</span><span class="sxs-lookup"><span data-stu-id="9f8f4-168">Next Tutorial: 4. Displaying Azure Spatial Anchor feedback</span></span>](mr-learning-asa-04.md)